<script>
  document.addEventListener("DOMContentLoaded", function() {
    var searchInput = document.getElementById("search_input");
    var timeout = null;

    searchInput.addEventListener("keyup", function() {
      clearTimeout(timeout);

      timeout = setTimeout(function() {
        document.getElementById("search_form").submit();
      }, 4000);
    });
  });
</script>

<p style="color: green"><%= notice %></p>

<h1>Messages</h1>

<%= button_to 'View Search Terms', search_terms_path, method: :get %>

<hr />

<%= form_tag messages_path, method: :get do %>
  <%= text_field_tag :search, params[:search] %>
  <%= submit_tag "Search" %>
<% end %>

<%= form_tag messages_path, method: :get, id: "search_form" do %>
  <%= text_field_tag :search, params[:search], id: "search_input" %>
  <%= submit_tag "Search", style: "display: none;" %>
<% end %>

<hr />

<%= link_to "New message", new_message_path %>

<hr />

<div id="messages">
  <% @messages.each do |message| %>
    <%= render message %>
    <p>
      <%= link_to "Show this message", message %>
    </p>
  <% end %>
</div>
